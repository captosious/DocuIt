@page "/workingcenter"
@using System.ComponentModel

@inject IStringLocalizer<WorkingCenter> Localizer
@inject WorkingCenterService WorkingCenterService


<h3 class="PageHeader">@Localizer["title"]</h3>
<DataGrid TItem="DocuitWeb.Models.WorkingCenter" Data="@objList" @bind-SelectedRow="@obj" RowClicked="@Edit" Editable="false" Filterable="true" Sortable="true" ShowPager="true" PageSize="5" Narrow="true" Hoverable="true">

    <DataGridCommandColumn TItem="DocuitWeb.Models.WorkingCenter">
        <DataGridColumn Width="100px" TItem="DocuitWeb.Models.WorkingCenter" Field="@nameof(DocuitWeb.Models.WorkingCenter.Id)" Caption="@Localizer["id"]" TextAlignment="TextAlignment.Left" />
        <DataGridColumn TItem="DocuitWeb.Models.WorkingCenter" Field="@nameof(DocuitWeb.Models.WorkingCenter.Name)" Caption="@Localizer["description"]" TextAlignment="TextAlignment.Justified" />
    </DataGridCommandColumn>
    <PreviousPageButtonTemplate></PreviousPageButtonTemplate>
</DataGrid>


<div class="d-flex justify-content-center">
    <button class="btn btn_general btn-success" @onclick="Add">@SharedLocalizer["MSG_ADD"]</button>
</div>

<Modal @ref="modalWindow" Closing="@OnClosing">
    <ModalBackdrop />
    <ModalContent Size="ModalSize.Default" Centered="true">
        <ModalHeader>
            <i class="fas fa-edit fa-2x"></i>
            <ModalTitle>@Localizer["edit"]</ModalTitle>
            <CloseButton Clicked="@CloseModal" />
        </ModalHeader>
        <ModalBody>
            <Addons>
                <Addon AddonType="AddonType.Start">
                    <AddonLabel Class="addonlabel_style">@Localizer["id"]</AddonLabel>
                </Addon>
                <Addon AddonType="AddonType.Body">
                    <TextEdit @bind-Text="@obj.Id" />
                </Addon>
            </Addons>
            <Addons>
                <Addon AddonType="AddonType.Start">
                    <AddonLabel Class="addonlabel_style">@Localizer["description"]</AddonLabel>
                </Addon>
                <Addon AddonType="AddonType.Body">
                    <TextEdit @bind-Text="@obj.Name" />
                </Addon>
            </Addons>
        </ModalBody>
        <ModalFooter>
            <button class="btn btn_general btn-success" @onclick="Save">@SharedLocalizer["MSG_SAVE"]</button>
        </ModalFooter>
    </ModalContent>
</Modal>
@code
{
    IEnumerable<DocuitWeb.Models.WorkingCenter> objList = new List<DocuitWeb.Models.WorkingCenter>();
    DocuitWeb.Models.WorkingCenter obj = new DocuitWeb.Models.WorkingCenter();
    DocuitWeb.Models.WorkingCenter objEdit = new DocuitWeb.Models.WorkingCenter();

    //Modal
    private Modal modalWindow;
    private bool IsNew = false;

    protected override async Task OnInitializedAsync()
    {
        myBlocker.Show();
        objList = await WorkingCenterService.FetchGetAllAsync();
        if (objList == null) { toastService.ShowError(@SharedLocalizer["OP_FAIL"], @SharedLocalizer["OP_FAIL_TITLE"]); }
        myBlocker.Hide();
    }

    private void Edit()
    {
        objEdit = (DocuitWeb.Models.WorkingCenter)obj.Clone();
        modalWindow.Show();
    }

    private async void Save()
    {
        myBlocker.Show();
        obj = await WorkingCenterService.PutAsync(objEdit);
        myBlocker.Hide();

        if (obj == null)
        {
            toastService.ShowError(@SharedLocalizer["OP_FAIL"], @SharedLocalizer["OP_FAIL_TITLE"]);
        }
        else
        {
            toastService.ShowSuccess(@SharedLocalizer["OP_OK"], @SharedLocalizer["OP_OK_TITLE"]);
        }
    }

    private void Add()
    {
        IsNew = true;
        obj = new Models.WorkingCenter();
        obj.CompanyId = 1;
        OpenModal();
    }

    // Modal
    private void CloseModal()
    {
        modalWindow.Hide();
    }

    private void OpenModal()
    {
        modalWindow.Show();
    }

    private void OnClosing(CancelEventArgs e)
    {
        //WorkingCenterService.Detach(obj);
        e.Cancel = false;
        IsNew = false;
        StateHasChanged();
    }
}